<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Affirmation - Luminacc</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #1a3a5f;
      font-family: 'Arial', sans-serif;
      color: #e0e1dd;
      min-height: 100vh;
      padding-top: 120px;
      display: flex;
      flex-direction: column;
    }

    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      text-align: center;
      padding: 20px;
      background: linear-gradient(135deg, #2c5282, #1a365d);
      color: white;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    header h1 {
      margin: 0;
      font-size: 2.2rem;
    }

    header p {
      margin: 8px 0 0;
      font-size: 1rem;
    }

    .back-btn {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      text-decoration: none;
      font-size: 16px;
      transition: background 0.3s;
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
    }

    .categories {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 30px;
      width: 100%;
    }

    .category-btn {
      background: #2c5282;
      border: 1px solid #4a7ba7;
      color: #e0e1dd;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }

    .category-btn:hover, .category-btn.active {
      background: #4a7ba7;
      color: white;
    }

    .quote-card {
      background: #2c5282;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      text-align: center;
      position: relative;
      margin-bottom: 30px;
      width: 100%;
      max-width: 600px;
      transform: translateY(0);
      transition: transform 0.5s, opacity 0.5s;
      border: 1px solid #4a7ba7;
    }

    .quote-card.new {
      animation: fadeIn 0.8s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .quote-mark {
      font-size: 4rem;
      color: rgba(74, 123, 167, 0.3);
      position: absolute;
      top: 10px;
      left: 20px;
    }

    .quote-text {
      font-size: 1.5rem;
      line-height: 1.6;
      margin: 20px 0;
      color: #ffffff;
      font-style: italic;
    }

    .quote-author {
      font-size: 1.1rem;
      color: #a0aec0;
      margin-top: 20px;
    }

    .quote-category {
      display: inline-block;
      background: linear-gradient(135deg, #2c5282, #4a7ba7);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      margin-top: 15px;
    }

    .quote-actions {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 30px;
    }

    .action-btn {
      background: #2c5282;
      border: 2px solid #4a7ba7;
      color: #e0e1dd;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .action-btn:hover {
      background: #4a7ba7;
      color: white;
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(74, 123, 167, 0.4);
    }

    .new-quote-btn {
      background: linear-gradient(135deg, #2c5282, #4a7ba7);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
      margin-top: 20px;
    }

    .new-quote-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(74, 123, 167, 0.4);
    }

    .add-affirmation-btn {
      background: linear-gradient(135deg, #2c5282, #4a7ba7);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
      margin-top: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .add-affirmation-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(74, 123, 167, 0.4);
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(26, 58, 95, 0.85);
    }

    .modal-content {
      background-color: #2c5282;
      margin: 15% auto;
      padding: 20px;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      border: 1px solid #4a7ba7;
    }

    .close {
      color: #a0aec0;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: #ffffff;
      text-decoration: none;
      cursor: pointer;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #ffffff;
    }

    .form-group input, .form-group textarea, .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #4a7ba7;
      border-radius: 5px;
      box-sizing: border-box;
      background-color: #1a3a5f;
      color: #e0e1dd;
    }

    .form-group textarea {
      height: 100px;
      resize: vertical;
    }

    .submit-btn {
      background: linear-gradient(135deg, #2c5282, #4a7ba7);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }

    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #2c5282;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transform: translateY(100px);
      opacity: 0;
      transition: transform 0.3s, opacity 0.3;
      z-index: 3000;
      color: #ffffff;
      border: 1px solid #4a7ba7;
    }

    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* Responsive adjustments */
    @media screen and (max-width: 768px) {
      body {
        padding-top: 100px;
      }

      header {
        padding: 15px;
      }

      header h1 {
        font-size: 1.8rem;
      }

      header p {
        font-size: 0.9rem;
      }

      .back-btn {
        padding: 6px 12px;
        font-size: 14px;
      }

      .quote-card {
        padding: 30px 20px;
      }

      .quote-text {
        font-size: 1.3rem;
      }

      .quote-actions {
        flex-wrap: wrap;
      }
    }

    @media screen and (max-width: 576px) {
      body {
        padding-top: 90px;
      }

      header h1 {
        font-size: 1.5rem;
      }

      .container {
        padding: 15px;
      }

      .quote-card {
        padding: 25px 15px;
      }

      .quote-text {
        font-size: 1.2rem;
      }

      .quote-mark {
        font-size: 3rem;
      }

      .action-btn {
        padding: 8px 15px;
        font-size: 14px;
      }

      .modal-content {
        width: 95%;
        margin: 20% auto;
      }
    }

    @media screen and (max-width: 400px) {
      .quote-text {
        font-size: 1.1rem;
      }

      .quote-author {
        font-size: 1rem;
      }

      .categories {
        gap: 8px;
      }

      .category-btn {
        padding: 6px 12px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html" class="back-btn">‚Üê Kembali</a>
    <h1>Daily Affirmation</h1>
    <p>Kutipan manis setiap hari untuk kamu</p>
  </header>

  <div class="container">
    <div class="categories">
      <button class="category-btn active" data-category="all">Semua</button>
      <button class="category-btn" data-category="latest">Terbaru</button>
      <button class="category-btn" data-category="love">Cinta</button>
      <button class="category-btn" data-category="motivation">Motivasi</button>
      <button class="category-btn" data-category="relationship">Hubungan</button>
      <button class="category-btn" data-category="happiness">Kebahagiaan</button>
    </div>

    <div class="quote-card" id="quoteCard">
      <div class="quote-mark">"</div>
      <div class="quote-text" id="quoteText">Memuat kutipan...</div>
      <div class="quote-author" id="quoteAuthor"></div>
      <div class="quote-category" id="quoteCategory"></div>
      <div class="quote-actions">
        <button class="action-btn" id="copyBtn">
          <span>üìã</span> Salin
        </button>
        <button class="action-btn" id="shareBtn">
          <span>üîó</span> Bagikan
        </button>
        <button class="action-btn" id="favoriteBtn">
          <span>‚ù§Ô∏è</span> Favorit
        </button>
      </div>
    </div>

    <button class="new-quote-btn" id="newQuoteBtn">Kutipan Baru</button>
    <button class="add-affirmation-btn" id="addAffirmationBtn">
      <span>‚ûï</span> Tambah Affirmation
    </button>
  </div>

  <!-- Modal for adding new affirmations -->
  <div id="affirmationModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Tambah Affirmation Baru</h2>
      <form id="affirmationForm">
        <div class="form-group">
          <label for="affirmationText">Kutipan</label>
          <textarea id="affirmationText" required></textarea>
        </div>
        <div class="form-group">
          <label for="affirmationAuthor">Penulis (opsional)</label>
          <input type="text" id="affirmationAuthor">
        </div>
        <div class="form-group">
          <label for="affirmationCategory">Kategori</label>
          <select id="affirmationCategory">
            <option value="love">Cinta</option>
            <option value="motivation">Motivasi</option>
            <option value="relationship">Hubungan</option>
            <option value="happiness">Kebahagiaan</option>
          </select>
        </div>
        <button type="submit" class="submit-btn">Tambah</button>
      </form>
    </div>
  </div>

  <div class="notification" id="notification"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      query,
      orderBy,
      Timestamp,
      limit
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDX-LrJEGQxODpEelbS8Pp-vm1CegLOceY",
      authDomain: "luminac-6437a.firebaseapp.com",
      projectId: "luminac-6437a",
      storageBucket: "luminac-6437a.appspot.com",
      messagingSenderId: "476684760512",
      appId: "1:476684760512:web:8a669df2e639cba4194425",
      measurementId: "G-E903BM0C2Q"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Quote data (default quotes)
    const defaultQuotes = [
      {
        text: "Cinta bukan tentang melihat kecantikan sempurna, tetapi tentang melihat ketidaksempurnaan dengan indah.",
        author: "Sam Keen",
        category: "love"
      },
      {
        text: "Kebahagiaan sejati datang dari memiliki rasa syukur untuk apa yang sudah kamu miliki.",
        author: "Unknown",
        category: "happiness"
      },
      {
        text: "Hubungan yang baik dibangun di atas kepercayaan, komunikasi, dan komitmen.",
        author: "Unknown",
        category: "relationship"
      },
      {
        text: "Setiap hari adalah kesempatan baru untuk menjadi lebih baik dari hari kemarin.",
        author: "Unknown",
        category: "motivation"
      },
      {
        text: "Cinta sejati tidak memiliki akhir yang bahagia. Cinta sejati tidak memiliki akhir.",
        author: "Richard Bach",
        category: "love"
      },
      {
        text: "Kebahagiaan adalah ketika apa yang kamu pikirkan, katakan, dan lakukan selaras.",
        author: "Mahatma Gandhi",
        category: "happiness"
      },
      {
        text: "Dalam hubungan, kekuatan sejati bukan tentang menang, tetapi tentang selalu bekerja sama.",
        author: "Unknown",
        category: "relationship"
      },
      {
        text: "Kesuksesan bukan kunci kebahagiaan. Kebahagiaan adalah kunci kesuksesan.",
        author: "Albert Schweitzer",
        category: "motivation"
      },
      {
        text: "Cinta terdiri dari satu jiwa yang menghuni dua tubuh.",
        author: "Aristotle",
        category: "love"
      },
      {
        text: "Kebahagiaan seperti kupu-kupu, semakin kamu mengejarnya, semakin ia menjauh. Tapi jika kamu memalingkan perhatianmu ke hal lain, ia akan datang dan duduk dengan lembut di bahumu.",
        author: "Henry David Thoreau",
        category: "happiness"
      },
      {
        text: "Komunikasi adalah kunci dalam hubungan. Tanpa itu, tidak ada kepercayaan, tanpa kepercayaan, tidak ada hubungan.",
        author: "Unknown",
        category: "relationship"
      },
      {
        text: "Jangan menunggu. Waktu tidak akan pernah tepat.",
        author: "Napoleon Hill",
        category: "motivation"
      }
    ];

    // Current quote
    let currentQuote = null;
    let currentCategory = 'all';
    let favoriteQuotes = JSON.parse(localStorage.getItem('favoriteQuotes')) || [];
    let allQuotes = [...defaultQuotes];
    let latestQuotes = [];

    // DOM elements
    const quoteCard = document.getElementById('quoteCard');
    const quoteText = document.getElementById('quoteText');
    const quoteAuthor = document.getElementById('quoteAuthor');
    const quoteCategory = document.getElementById('quoteCategory');
    const newQuoteBtn = document.getElementById('newQuoteBtn');
    const copyBtn = document.getElementById('copyBtn');
    const shareBtn = document.getElementById('shareBtn');
    const favoriteBtn = document.getElementById('favoriteBtn');
    const addAffirmationBtn = document.getElementById('addAffirmationBtn');
    const affirmationForm = document.getElementById('affirmationForm');
    const notification = document.getElementById('notification');
    const modal = document.getElementById('affirmationModal');
    const closeBtn = document.getElementsByClassName('close')[0];

    // Event listeners
    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        // Remove active class from all buttons
        document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
        
        // Add active class to clicked button
        this.classList.add('active');
        
        // Set current category and load new quote
        currentCategory = this.dataset.category;
        loadQuote();
      });
    });

    newQuoteBtn.addEventListener('click', loadQuote);
    copyBtn.addEventListener('click', copyQuote);
    shareBtn.addEventListener('click', shareQuote);
    favoriteBtn.addEventListener('click', toggleFavorite);
    affirmationForm.addEventListener('submit', addCustomAffirmation);
    
    // Modal event listeners
    addAffirmationBtn.addEventListener('click', () => {
      modal.style.display = 'block';
    });
    
    closeBtn.addEventListener('click', () => {
      modal.style.display = 'none';
    });
    
    window.addEventListener('click', (event) => {
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    });

    // Listen to affirmations from Firebase
    function listenToAffirmations() {
      const q = query(collection(db, "affirmations"), orderBy("createdAt", "desc"));
      onSnapshot(q, (snapshot) => {
        latestQuotes = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          latestQuotes.push({
            text: data.text,
            author: data.author,
            category: data.category,
            id: doc.id
          });
        });
        
        // Update all quotes with the latest from Firebase
        allQuotes = [...defaultQuotes, ...latestQuotes];
        
        // If this is the first load, load a quote
        if (!currentQuote) {
          loadQuote();
        }
      });
    }

    // Load quote
    function loadQuote() {
      let filteredQuotes = allQuotes;
      
      // Filter by category
      if (currentCategory === 'latest') {
        // Show only the latest 5 quotes
        filteredQuotes = latestQuotes.slice(0, 5);
      } else if (currentCategory !== 'all') {
        filteredQuotes = allQuotes.filter(quote => quote.category === currentCategory);
      }
      
      // If no quotes found, show a message
      if (filteredQuotes.length === 0) {
        quoteText.textContent = "Tidak ada kutipan dalam kategori ini.";
        quoteAuthor.textContent = "";
        quoteCategory.textContent = "";
        updateFavoriteButton();
        return;
      }
      
      // Get random quote
      const randomIndex = Math.floor(Math.random() * filteredQuotes.length);
      currentQuote = filteredQuotes[randomIndex];
      
      // Update UI with animation
      quoteCard.classList.remove('new');
      void quoteCard.offsetWidth; // Trigger reflow
      quoteCard.classList.add('new');
      
      quoteText.textContent = currentQuote.text;
      quoteAuthor.textContent = currentQuote.author ? `- ${currentQuote.author}` : '';
      
      // Set category text
      const categoryText = {
        'love': 'Cinta',
        'motivation': 'Motivasi',
        'relationship': 'Hubungan',
        'happiness': 'Kebahagiaan'
      };
      quoteCategory.textContent = categoryText[currentQuote.category] || currentQuote.category;
      
      // Update favorite button
      updateFavoriteButton();
    }

    // Copy quote
    function copyQuote() {
      const textToCopy = `"${currentQuote.text}" ${currentQuote.author ? `- ${currentQuote.author}` : ''}`;
      
      navigator.clipboard.writeText(textToCopy).then(() => {
        showNotification('Kutipan disalin!');
      }).catch(err => {
        console.error('Gagal menyalin: ', err);
        showNotification('Gagal menyalin kutipan');
      });
    }

    // Share quote
    function shareQuote() {
      const textToShare = `"${currentQuote.text}" ${currentQuote.author ? `- ${currentQuote.author}` : ''}`;
      
      if (navigator.share) {
        navigator.share({
          title: 'Daily Affirmation',
          text: textToShare
        }).then(() => {
          showNotification('Kutipan dibagikan!');
        }).catch(err => {
          console.error('Gagal membagikan: ', err);
          showNotification('Gagal membagikan kutipan');
        });
      } else {
        // Fallback for browsers that don't support Web Share API
        const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(textToShare)}`;
        window.open(url, '_blank');
      }
    }

    // Toggle favorite
    function toggleFavorite() {
      if (!currentQuote) return;
      
      const quoteId = currentQuote.id || currentQuote.text; // Use Firebase ID if available, otherwise use text
      
      if (favoriteQuotes.includes(quoteId)) {
        // Remove from favorites
        favoriteQuotes = favoriteQuotes.filter(id => id !== quoteId);
        showNotification('Dihapus dari favorit');
      } else {
        // Add to favorites
        favoriteQuotes.push(quoteId);
        showNotification('Ditambahkan ke favorit');
      }
      
      // Save to localStorage
      localStorage.setItem('favoriteQuotes', JSON.stringify(favoriteQuotes));
      
      // Update button
      updateFavoriteButton();
    }

    // Update favorite button
    function updateFavoriteButton() {
      if (!currentQuote) return;
      
      const quoteId = currentQuote.id || currentQuote.text;
      
      if (favoriteQuotes.includes(quoteId)) {
        favoriteBtn.innerHTML = '<span>‚ù§Ô∏è</span> Difavoritkan';
      } else {
        favoriteBtn.innerHTML = '<span>ü§ç</span> Favorit';
      }
    }

    // Add custom affirmation
    async function addCustomAffirmation(e) {
      e.preventDefault();
      
      const text = document.getElementById('affirmationText').value;
      const author = document.getElementById('affirmationAuthor').value;
      const category = document.getElementById('affirmationCategory').value;
      
      const newAffirmation = {
        text,
        author,
        category,
        createdAt: Timestamp.fromDate(new Date())
      };
      
      try {
        // Add to Firebase
        await addDoc(collection(db, "affirmations"), newAffirmation);
        console.log("Affirmation berhasil disimpan ke Firebase!");
        
        // Reset form
        affirmationForm.reset();
        
        // Close modal
        modal.style.display = 'none';
        
        // Show notification
        showNotification('Affirmation ditambahkan!');
        
        // Load the new affirmation
        currentQuote = newAffirmation;
        quoteText.textContent = currentQuote.text;
        quoteAuthor.textContent = currentQuote.author ? `- ${currentQuote.author}` : '';
        
        // Set category text
        const categoryText = {
          'love': 'Cinta',
          'motivation': 'Motivasi',
          'relationship': 'Hubungan',
          'happiness': 'Kebahagiaan'
        };
        quoteCategory.textContent = categoryText[currentQuote.category] || currentQuote.category;
        
        // Update favorite button
        updateFavoriteButton();
      } catch (error) {
        console.error("Gagal menyimpan affirmation:", error);
        showNotification('Gagal menambahkan affirmation');
      }
    }

    // Show notification
    function showNotification(message) {
      notification.textContent = message;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Initialize
    listenToAffirmations();
  </script>
</body>
</html>