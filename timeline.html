<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Love Timeline - Luminacc</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #e6f2ff;
      font-family: 'Arial', sans-serif;
      color: #333;
      min-height: 100vh;
      padding-top: 120px;
      /* Space for fixed header */
    }

    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      text-align: center;
      padding: 20px;
      background: linear-gradient(135deg, #87ceeb, #4a90e2);
      color: white;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    header h1 {
      margin: 0;
      font-size: 2.2rem;
    }

    header p {
      margin: 8px 0 0;
      font-size: 1rem;
    }

    .back-btn {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.3);
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      text-decoration: none;
      font-size: 16px;
      transition: background 0.3s;
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    .timeline-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .timeline {
      position: relative;
      margin: 0 auto;
      padding: 20px 0;
    }

    .timeline::after {
      content: '';
      position: absolute;
      width: 6px;
      background-color: #4a90e2;
      top: 0;
      bottom: 0;
      left: 50%;
      margin-left: -3px;
      border-radius: 3px;
    }

    .timeline-item {
      padding: 15px 40px;
      position: relative;
      width: 50%;
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.6s, transform 0.6s;
    }

    .timeline-item.show {
      opacity: 1;
      transform: translateY(0);
    }

    .timeline-item::after {
      content: '';
      position: absolute;
      width: 25px;
      height: 25px;
      right: -12px;
      background-color: white;
      border: 4px solid #4a90e2;
      top: 20px;
      border-radius: 50%;
      z-index: 1;
    }

    .left {
      left: 0;
    }

    .right {
      left: 50%;
    }

    .left::before {
      content: " ";
      height: 0;
      position: absolute;
      top: 27px;
      width: 0;
      z-index: 1;
      right: 30px;
      border: medium solid white;
      border-width: 10px 0 10px 10px;
      border-color: transparent transparent transparent white;
    }

    .right::before {
      content: " ";
      height: 0;
      position: absolute;
      top: 27px;
      width: 0;
      z-index: 1;
      left: 30px;
      border: medium solid white;
      border-width: 10px 10px 10px 0;
      border-color: transparent white transparent transparent;
    }

    .right::after {
      left: -12px;
    }

    .timeline-content {
      padding: 20px;
      background-color: white;
      position: relative;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .timeline-date {
      font-weight: bold;
      color: #2e7cd6;
      margin-bottom: 10px;
      font-size: 0.9rem;
    }

    .timeline-title {
      font-size: 1.2rem;
      margin-bottom: 10px;
      color: #333;
    }

    .timeline-desc {
      margin-bottom: 15px;
      line-height: 1.5;
      font-size: 0.95rem;
    }

    .timeline-img {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    .add-event-btn {
      display: block;
      margin: 40px auto;
      padding: 12px 25px;
      background: linear-gradient(135deg, #87ceeb, #4a90e2);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .add-event-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #2e7cd6;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #87ceeb;
      border-radius: 5px;
      box-sizing: border-box;
    }

    .form-group textarea {
      height: 100px;
      resize: vertical;
    }

    .submit-btn {
      background: linear-gradient(135deg, #87ceeb, #4a90e2);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }

    /* Responsive adjustments */
    @media screen and (max-width: 992px) {
      .timeline-item {
        padding: 10px 30px;
      }

      .timeline-content {
        padding: 15px;
      }
    }

    @media screen and (max-width: 768px) {
      body {
        padding-top: 100px;
      }

      header {
        padding: 15px;
      }

      header h1 {
        font-size: 1.8rem;
      }

      header p {
        font-size: 0.9rem;
      }

      .back-btn {
        padding: 6px 12px;
        font-size: 14px;
      }

      .timeline::after {
        left: 50%;
      }

      .timeline-item {
        width: 50%;
        padding-left: 30px;
        padding-right: 30px;
      }

      .left::before {
        right: 20px;
      }

      .right::before {
        left: 20px;
      }

      .timeline-content {
        padding: 12px;
      }

      .timeline-title {
        font-size: 1rem;
      }

      .timeline-desc {
        font-size: 0.9rem;
      }
    }

    @media screen and (max-width: 576px) {
      body {
        padding-top: 90px;
      }

      header h1 {
        font-size: 1.5rem;
      }

      .timeline-container {
        padding: 15px;
      }

      .timeline-item {
        padding-left: 20px;
        padding-right: 20px;
      }

      .timeline-content {
        padding: 10px;
      }

      .timeline-date {
        font-size: 0.8rem;
      }

      .timeline-title {
        font-size: 0.95rem;
      }

      .timeline-desc {
        font-size: 0.85rem;
      }

      .modal-content {
        width: 95%;
        margin: 20% auto;
      }
    }

    @media screen and (max-width: 400px) {
      .timeline-item {
        padding-left: 15px;
        padding-right: 15px;
      }

      .timeline-item::after {
        width: 20px;
        height: 20px;
        right: -10px;
        top: 15px;
      }

      .right::after {
        left: -10px;
      }

      .left::before {
        right: 15px;
        border-width: 8px 0 8px 8px;
      }

      .right::before {
        left: 15px;
        border-width: 8px 8px 8px 0;
      }
    }
  </style>
</head>

<body>
  <header>
    <a href="index.html" class="back-btn">‚Üê Kembali</a>
    <h1>Perjalanan Cinta Kita</h1>
    <p>Setiap momen berharga dalam perjalanan kita</p>
  </header>

  <div class="timeline-container">
    <div class="timeline" id="timeline">
      <!-- Timeline items will be dynamically added here -->
    </div>

    <button class="add-event-btn" id="addEventBtn">Tambah Momen Baru</button>
  </div>

  <!-- Modal for adding new events -->
  <div id="eventModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Tambah Momen Baru</h2>
      <form id="eventForm">
        <div class="form-group">
          <label for="eventDate">Tanggal</label>
          <input type="date" id="eventDate" required>
        </div>
        <div class="form-group">
          <label for="eventTitle">Judul</label>
          <input type="text" id="eventTitle" required>
        </div>
        <div class="form-group">
          <label for="eventDesc">Deskripsi</label>
          <textarea id="eventDesc" required></textarea>
        </div>
        <div class="form-group">
          <label for="eventImg">URL Gambar (opsional)</label>
          <input type="text" id="eventImg" placeholder="https://example.com/image.jpg">
        </div>
        <button type="submit" class="submit-btn">Simpan</button>
      </form>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      query,
      orderBy,
      Timestamp
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDX-LrJEGQxODpEelbS8Pp-vm1CegLOceY",
      authDomain: "luminac-6437a.firebaseapp.com",
      projectId: "luminac-6437a",
      storageBucket: "luminac-6437a.appspot.com",
      messagingSenderId: "476684760512",
      appId: "1:476684760512:web:8a669df2e639cba4194425",
      measurementId: "G-E903BM0C2Q"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function formatDate(dateValue) {
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      const dateObj = dateValue?.toDate ? dateValue.toDate() : new Date(dateValue);
      return dateObj.toLocaleDateString('id-ID', options);
    }

    function createTimelineItem(data, index) {
      const isLeft = index % 2 === 0;
      const timelineItem = document.createElement('div');
      timelineItem.className = `timeline-item ${isLeft ? 'left' : 'right'}`;

      const content = `
      <div class="timeline-content">
        <div class="timeline-date">${formatDate(data.date)}</div>
        <div class="timeline-title">${data.title}</div>
        ${data.image ? `<img src="${data.image}" alt="${data.title}" class="timeline-img">` : ''}
        <div class="timeline-desc">${data.description}</div>
      </div>
    `;
      timelineItem.innerHTML = content;
      return timelineItem;
    }

    function listenToTimeline() {
      const timeline = document.getElementById('timeline');
      timeline.innerHTML = '';

      const q = query(collection(db, "timelineEvents"), orderBy("date"));
      onSnapshot(q, (snapshot) => {
        timeline.innerHTML = '';
        let index = 0;
        snapshot.forEach(doc => {
          const data = doc.data();
          const item = createTimelineItem(data, index);
          timeline.appendChild(item);
          index++;
        });

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('show');
            }
          });
        }, { threshold: 0.1 });

        document.querySelectorAll('.timeline-item').forEach(item => {
          observer.observe(item);
        });
      });
    }

    const modal = document.getElementById('eventModal');
    const btn = document.getElementById('addEventBtn');
    const span = document.getElementsByClassName('close')[0];
    const form = document.getElementById('eventForm');

    btn.onclick = () => modal.style.display = 'block';
    span.onclick = () => modal.style.display = 'none';
    window.onclick = (event) => {
      if (event.target == modal) modal.style.display = 'none';
    };

    form.onsubmit = async function (e) {
      e.preventDefault();

      const newEvent = {
        date: Timestamp.fromDate(new Date(document.getElementById('eventDate').value)),
        title: document.getElementById('eventTitle').value,
        description: document.getElementById('eventDesc').value,
        image: document.getElementById('eventImg').value || ''
      };

      try {
        await addDoc(collection(db, "timelineEvents"), newEvent);
        console.log("Event berhasil disimpan ke Firebase!");
      } catch (error) {
        console.error("Gagal menyimpan event:", error);
      }

      form.reset();
      modal.style.display = 'none';
    };

    // Jalankan saat halaman dimuat
    listenToTimeline();
  </script>
</body>

</html>