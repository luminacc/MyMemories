<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Diary Book | Luminacc</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --primary: #006064;
      --primary-dark: #004d40;
      --bg1: #f9f9f9;
      --bg2: #e0f7fa;
      --text: #333;
      --muted: #777;
      --card: #ffffff;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --danger: #f44336;
    }

    * {
      box-sizing: border-box
    }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      margin: 0;
      color: var(--text);
    }

    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--primary);
      color: #fff;
      padding: 1rem 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
    }

    .header-inner {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: .75rem;
    }

    .brand h1 {
      margin: 0;
      font-weight: 600;
      font-size: 1.25rem
    }

    .brand small {
      opacity: .9
    }

    .actions {
      display: flex;
      gap: .5rem;
      align-items: center;
    }

    .btn {
      border: none;
      border-radius: 10px;
      padding: .6rem 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform .15s ease, background .25s ease, opacity .25s ease;
    }

    .btn-primary {
      background: #fff;
      color: var(--primary)
    }

    .btn-outline {
      background: transparent;
      color: #fff;
      border: 1px solid rgba(255, 255, 255, .6)
    }

    .btn:active {
      transform: scale(.98)
    }

    .btn[disabled] {
      opacity: .6;
      cursor: not-allowed
    }

    .user-chip {
      display: flex;
      align-items: center;
      gap: .5rem;
      color: #fff;
      font-weight: 600;
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, .7);
    }

    .container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem
    }

    .hero {
      background: var(--card);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 1.25rem 1.25rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .hero h2 {
      margin: .25rem 0 .25rem;
      font-weight: 700
    }

    .hero p {
      margin: 0;
      color: var(--muted)
    }

    .status {
      display: flex;
      align-items: center;
      gap: .5rem;
      color: var(--muted);
      font-size: .95rem;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #bbb;
      display: inline-block;
    }

    .dot.online {
      background: #4caf50
    }

    .dot.offline {
      background: #f44336
    }

    .diary-form {
      background: var(--card);
      padding: 1.25rem;
      border-radius: 16px;
      box-shadow: var(--shadow);
      margin-bottom: 1.25rem;
    }

    .diary-form textarea {
      width: 100%;
      min-height: 140px;
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid #ddd;
      font-size: 1rem;
      resize: vertical;
      outline: none;
      transition: border .2s ease, box-shadow .2s ease;
    }

    .diary-form textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 96, 100, .12);
    }

    .form-row {
      display: flex;
      gap: .75rem;
      align-items: center;
      justify-content: space-between;
      margin-top: .75rem;
    }

    .hint {
      color: var(--muted);
      font-size: .9rem
    }

    .btn-save {
      background: var(--primary);
      color: #fff
    }

    .btn-save:hover {
      background: var(--primary-dark)
    }

    .entries {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .entry {
      background: var(--card);
      padding: 1rem;
      border-radius: 14px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      animation: fadeIn .35s ease;
    }

    .entry time {
      font-size: .9rem;
      color: var(--muted);
      display: block;
      margin-bottom: .5rem
    }

    .entry p {
      margin: .25rem 0 0;
      line-height: 1.6;
      white-space: pre-wrap
    }

    .entry-tools {
      display: flex;
      gap: .5rem;
      margin-top: .5rem;
    }

    .tool {
      font-size: .85rem;
      padding: .35rem .6rem;
      border-radius: 8px;
      border: 1px solid #ddd;
      background: #fff;
      cursor: pointer;
    }

    .tool:hover {
      background: #f7f7f7
    }

    .tool.hide {
      color: var(--danger);
      border-color: var(--danger);
    }

    .tool.hide:hover {
      background: rgba(244, 67, 54, 0.1);
    }

    .empty {
      text-align: center;
      color: var(--muted);
      padding: 1.25rem;
      border: 1px dashed #cfd8dc;
      border-radius: 12px;
      background: #fafafa;
    }

    .loading {
      display: flex;
      align-items: center;
      gap: .6rem;
      color: var(--muted);
    }

    .spinner {
      width: 18px;
      height: 18px;
      border: 2px solid #cfd8dc;
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin .8s linear infinite;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 100;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: var(--card);
      padding: 1.5rem;
      border-radius: 16px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .modal-title {
      margin: 0 0 1rem;
      font-weight: 600;
      color: var(--danger);
    }

    .modal-text {
      margin: 0 0 1.5rem;
      color: var(--text);
    }

    .modal-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
    }

    .btn-cancel {
      background: #e0e0e0;
      color: var(--text);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(6px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    footer {
      text-align: center;
      color: var(--muted);
      padding: 2rem 1rem 3rem;
    }

    @media (max-width:640px) {
      .hero {
        flex-direction: column;
        align-items: flex-start
      }

      .form-row {
        flex-direction: column;
        align-items: flex-end
      }

      .user-chip {
        display: none
      }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <div class="header-inner">
      <div class="brand">
        <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f4d6.svg" alt="book" width="24"
          height="24" />
        <div>
          <h1>Diary Book</h1>
          <small>Luminacc • privat & elegan</small>
        </div>
      </div>
      <div class="actions">
        <div id="userChip" class="user-chip" style="display:none;">
          <img id="userAvatar" class="avatar" src="" alt="avatar" />
          <span id="userName">User</span>
        </div>
        <button id="loginBtn" class="btn btn-primary">Masuk dengan Google</button>
        <button id="logoutBtn" class="btn btn-outline" style="display:none;">Keluar</button>
      </div>
    </div>
  </header>

  <!-- Top hero -->
  <div class="container">
    <div class="hero">
      <div>
        <h2>Catatan harian luna cantik kesayanganku</h2>
        <p>Tulis perasaan, momen kecil, dan hal-hal yang ingin kamu simpan dengan tenang okee sayang I LOVE YOU LUNA.</p>
      </div>
      <div class="status">
        <span class="dot offline" id="statusDot"></span>
        <span id="statusText">Belum masuk</span>
      </div>
    </div>

    <!-- Form -->
    <div class="diary-form">
      <textarea id="diaryInput" placeholder="Tulis curhat atau catatan harianmu..."></textarea>
      <div class="form-row">
        <span class="hint" id="hintText">Masuk untuk menyimpan catatan sayang.</span>
        <button id="saveBtn" class="btn btn-save" disabled>Simpan Catatan</button>
      </div>
    </div>

    <!-- Entries -->
    <div id="entriesWrap">
      <div class="loading" id="loading" style="display:none;">
        <div class="spinner"></div>
        <span>Memuat catatan...</span>
      </div>
      <div class="entries" id="entries"></div>
      <div class="empty" id="empty" style="display:none;">Belum ada catatan. Tulis sesuatu yang berarti hari ini ✨</div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <h3 class="modal-title">Hapus Catatan</h3>
      <p class="modal-text">Apakah kamu yakin ingin menghapus catatan ini luna sayang? Catatan yang dihapus tidak akan bisa dibaca lagi.</p>
      <div class="modal-actions">
        <button id="cancelBtn" class="btn btn-cancel">Batal</button>
        <button id="confirmBtn" class="btn btn-danger">Hapus</button>
      </div>
    </div>
  </div>

  <footer>
    &copy; 2026 Luminacc • Disimpan aman di Hatiku • aku Hanya milikmu
  </footer>

  <!-- Firebase + App -->
  <script type="module">
    // Firebase SDK (modular)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

    // TODO: Ganti dengan config milikmu dari Firebase Console
    const firebaseConfig = {
      apiKey: "AIzaSyDX-LrJEGQxODpEelbS8Pp-vm1CegLOceY",
      authDomain: "luminac-6437a.firebaseapp.com",
      projectId: "luminac-6437a",
      storageBucket: "luminac-6437a.firebasestorage.app",
      messagingSenderId: "476684760512",
      appId: "1:476684760512:web:8a669df2e639cba4194425",
      measurementId: "G-E903BM0C2Q"
    };

    // Init
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // UI refs
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userChip = document.getElementById('userChip');
    const userNameEl = document.getElementById('userName');
    const userAvatar = document.getElementById('userAvatar');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const hintText = document.getElementById('hintText');
    const diaryInput = document.getElementById('diaryInput');
    const saveBtn = document.getElementById('saveBtn');
    const entriesDiv = document.getElementById('entries');
    const loadingEl = document.getElementById('loading');
    const emptyEl = document.getElementById('empty');
    
    // Modal refs
    const confirmModal = document.getElementById('confirmModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const confirmBtn = document.getElementById('confirmBtn');

    let currentUser = null;
    let docToHide = null;

    // Auth state
    onAuthStateChanged(auth, async (user) => {
      currentUser = user || null;
      if (currentUser) {
        // Logged in
        userChip.style.display = 'flex';
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        statusDot.classList.remove('offline'); statusDot.classList.add('online');
        statusText.textContent = 'Masuk';
        hintText.textContent = 'Catatan akan disimpan disini dan hanya bisa diakses oleh kamu luna cantik okeeeeeee,-------fadli ga bisa liat ko.';
        userNameEl.textContent = currentUser.displayName || 'Pengguna';
        userAvatar.src = currentUser.photoURL || 'https://via.placeholder.com/32';
        saveBtn.disabled = false;
        await renderEntries();
      } else {
        // Logged out
        userChip.style.display = 'none';
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        statusDot.classList.remove('online'); statusDot.classList.add('offline');
        statusText.textContent = 'Belum masuk';
        hintText.textContent = 'Masuk pake akun google sayang buat save catatanya okeyy.';
        saveBtn.disabled = true;
        entriesDiv.innerHTML = '';
        emptyEl.style.display = 'block';
      }
    });

    // Login
    loginBtn.addEventListener('click', async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (err) {
        alert('Gagal masuk: ' + (err?.message || err));
      }
    });

    // Logout
    logoutBtn.addEventListener('click', async () => {
      try {
        await signOut(auth);
      } catch (err) {
        alert('Gagal keluar: ' + (err?.message || err));
      }
    });

    // Modal event listeners
    cancelBtn.addEventListener('click', () => {
      confirmModal.style.display = 'none';
      docToHide = null;
    });

    confirmBtn.addEventListener('click', async () => {
      if (docToHide) {
        await hideEntry(docToHide);
        docToHide = null;
      }
      confirmModal.style.display = 'none';
    });

    // Render entries for current user
    async function renderEntries() {
      if (!currentUser) return;
      loadingEl.style.display = 'flex';
      emptyEl.style.display = 'none';
      entriesDiv.innerHTML = '';

      try {
        // Query hanya catatan milik user (uid sama), yang tidak disembunyikan, urut terbaru
        const q = query(
          collection(db, 'notes'),
          where('uid', '==', currentUser.uid),
          where('hidden', '==', false),
          orderBy('date', 'desc')
        );
        const snap = await getDocs(q);
        if (snap.empty) {
          emptyEl.style.display = 'block';
        } else {
          snap.forEach(doc => {
            const data = doc.data();
            const entryDiv = document.createElement('div');
            entryDiv.className = 'entry';
            entryDiv.innerHTML = `
              <time>${new Date(data.date).toLocaleString('id-ID')}</time>
              <p>${escapeHtml(data.text)}</p>
              <div class="entry-tools">
                <button class="tool hide" data-id="${doc.id}">Hapus</button>
              </div>
            `;
            entriesDiv.appendChild(entryDiv);
            
            // Add event listener to hide button
            const hideBtn = entryDiv.querySelector('.tool.hide');
            hideBtn.addEventListener('click', () => {
              docToHide = doc.id;
              confirmModal.style.display = 'flex';
            });
          });
        }
      } catch (err) {
        alert('Gagal memuat catatan: ' + (err?.message || err));
      } finally {
        loadingEl.style.display = 'none';
      }
    }

    // Hide entry function
    async function hideEntry(docId) {
      try {
        const docRef = doc(db, 'notes', docId);
        await updateDoc(docRef, { hidden: true });
        await renderEntries();
      } catch (err) {
        alert('Gagal menyembunyikan catatan: ' + (err?.message || err));
      }
    }

    // Save entry
    saveBtn.addEventListener('click', async () => {
      const text = diaryInput.value.trim();
      if (!currentUser) {
        alert('Silakan masuk terlebih dahulu.');
        return;
      }
      if (!text) {
        alert('Tulis sesuatu dulu ya.');
        return;
      }
      saveBtn.disabled = true;
      try {
        await addDoc(collection(db, 'notes'), {
          text,
          date: Date.now(),
          uid: currentUser.uid,
          hidden: false  // New entries are not hidden by default
        });
        diaryInput.value = '';
        await renderEntries();
      } catch (err) {
        alert('Gagal menyimpan catatan: ' + (err?.message || err));
      } finally {
        saveBtn.disabled = false;
      }
    });

    // Basic HTML escaping to avoid injection in <p>
    function escapeHtml(str) {
      return str
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
    }

    const q = query(
  collection(db, 'notes'),
  where('uid', '==', currentUser.uid),
  where('hidden', '==', false),
  orderBy('date', 'desc')
);

getDocs(q)
  .then(snapshot => {
    console.log("Catatan berhasil dimuat:", snapshot.docs.length);
  })
  .catch(err => {
    console.error("Error Firestore:", err.code, err.message);
  });

  </script>
</body>

</html>